<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="description" content="A report of the things I like and dislike about the Swift language, specifically in comparison to C++ and Rust.">
    <meta name="author" content="Diego Frias">
    <meta name="robots" content="follow, index, max-snippet:-1, max-video-preview:-1, max-image-preview:large">
    <title>Experiments with the Swift Language - dzfrias</title>
    <link rel="stylesheet" href="/css/style.css">
    <script type="module" src="/js/index.js"></script>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#0f0f0f">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
    <meta name="theme-color" content="#0f0f0f">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link rel="preconnect" href="https://fonts.gstatic.com"><link data-href="https://fonts.googleapis.com/css2?family=Frank+Ruhl+Libre:wght@300..900&display=swap" rel="stylesheet"><style data-href="https://fonts.googleapis.com/css2?family=Frank+Ruhl+Libre:wght@300..900&display=swap">/* hebrew */
@font-face {
  font-family: 'Frank Ruhl Libre';
  font-style: normal;
  font-weight: 300 900;
  font-display: swap;
  src: url(https://fonts.gstatic.com/s/frankruhllibre/v21/j8_w6_fAw7jrcalD7oKYNX0QfAnPW7Ll4brkiY-xBg.woff2) format('woff2');
  unicode-range: U+0307-0308, U+0590-05FF, U+200C-2010, U+20AA, U+25CC, U+FB1D-FB4F;
}
/* latin-ext */
@font-face {
  font-family: 'Frank Ruhl Libre';
  font-style: normal;
  font-weight: 300 900;
  font-display: swap;
  src: url(https://fonts.gstatic.com/s/frankruhllibre/v21/j8_w6_fAw7jrcalD7oKYNX0QfAnPW77l4brkiY-xBg.woff2) format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
/* latin */
@font-face {
  font-family: 'Frank Ruhl Libre';
  font-style: normal;
  font-weight: 300 900;
  font-display: swap;
  src: url(https://fonts.gstatic.com/s/frankruhllibre/v21/j8_w6_fAw7jrcalD7oKYNX0QfAnPW7Dl4brkiY8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
</style>
  </head>
  <body>
    <header>
      <nav>
        <a href="/" aria-label="Home">
          <div class="header-logo">
            <svg class="profile" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_1_2)">
<rect width="200" height="200" fill="#7B7B7B"></rect>
<path d="M-50 -50L245 245L-50 240.719V-50Z" fill="#040404"></path>
<path d="M98.45 34.8C106.25 34.2 110.1 33.9 110 33.9C110.9 33.9 111.5 34.25 111.8 34.95C111.9 35.35 108.3 50.25 101 79.65L89.6 125.25C89.4 127.55 89.4 129.4 89.6 130.8C89.8 131.3 90.1 131.7 90.5 132C90.8 132.3 91.25 132.45 91.85 132.45C92.55 132.45 93.1 132.35 93.5 132.15C95.4 130.75 97.35 126.2 99.35 118.5C99.85 116.6 100.25 115.55 100.55 115.35C100.75 115.15 101.95 115.05 104.15 115.05C106.35 115.05 107.6 115.15 107.9 115.35C108.1 115.55 108.2 115.95 108.2 116.55C108.2 117.15 107.95 118.35 107.45 120.15C103.75 132.75 98.5 139.25 91.7 139.65C86.6 139.95 82.5 138.2 79.4 134.4C78.9 133.8 78.45 133.15 78.05 132.45C77.85 131.85 77.7 131.55 77.6 131.55L76.55 132.45C73.05 135.55 69.6 137.6 66.2 138.6C59.7 140.8 53.85 139.8 48.65 135.6C48.05 135.1 47.5 134.55 47 133.95C45.5 132.45 44.25 130.65 43.25 128.55C40.75 123.45 39.95 117.4 40.85 110.4C42.45 99 47.3 89.4 55.4 81.6C60.6 76.6 66.25 73.45 72.35 72.15C73.25 71.95 74.65 71.85 76.55 71.85C79.05 71.85 81.2 72.25 83 73.05C84.4 73.75 85.7 74.7 86.9 75.9C87.7 76.7 88.1 77 88.1 76.8C88.2 76.7 89.45 71.9 91.85 62.4C94.15 53.1 95.35 47.9 95.45 46.8C95.45 45.9 95.35 45.35 95.15 45.15C94.45 44.45 92.3 44.05 88.7 43.95C86.3 43.95 84.9 43.6 84.5 42.9L84.35 42.45L85.1 39.45C85.5 37.55 85.9 36.4 86.3 36C86.6 35.7 86.9 35.55 87.2 35.55L98.45 34.8ZM77.15 78.9C73.05 78.2 69.1 80.15 65.3 84.75C64.3 86.05 63.4 87.45 62.6 88.95C61.1 91.85 59.3 97.55 57.2 106.05C55.9 110.85 54.95 115.05 54.35 118.65C53.95 122.05 53.95 124.65 54.35 126.45C55.35 129.95 57.3 131.95 60.2 132.45C61.9 132.75 63.95 132.4 66.35 131.4C69.95 129.4 73.35 126.05 76.55 121.35L77.3 120.3L81.05 105.3L84.8 90.3L84.5 89.25C83.6 83.55 81.4 80.15 77.9 79.05C77.7 78.95 77.45 78.9 77.15 78.9ZM154.811 32.4C155.311 32.3 156.311 32.25 157.811 32.25C160.111 32.35 162.211 32.9 164.111 33.9C168.011 35.9 169.961 39.1 169.961 43.5C169.961 45.3 169.561 47 168.761 48.6C168.361 49.6 167.761 50.45 166.961 51.15C165.961 52.15 165.111 52.8 164.411 53.1C161.611 54.4 158.961 54.45 156.461 53.25C153.961 51.95 153.061 49.65 153.761 46.35C153.861 45.95 153.961 45.55 154.061 45.15C154.761 42.85 156.011 41.15 157.811 40.05C158.311 39.75 157.961 39.5 156.761 39.3C156.061 39.3 155.561 39.4 155.261 39.6C154.461 40.2 153.911 40.9 153.611 41.7C153.211 42.5 152.161 47.1 150.461 55.5C148.161 66.5 147.011 72.4 147.011 73.2C147.011 73.3 149.711 73.35 155.111 73.35H163.211L163.811 73.8C164.211 74.3 164.161 75.65 163.661 77.85C163.161 80.05 162.711 81.25 162.311 81.45C162.011 81.65 159.111 81.75 153.611 81.75C148.111 81.75 145.361 81.85 145.361 82.05L141.461 101.85L136.961 125.1C134.261 138.1 131.661 147.4 129.161 153C125.961 160.4 121.861 165.25 116.861 167.55C115.461 168.25 113.961 168.65 112.361 168.75C107.961 168.95 104.461 167.6 101.861 164.7C101.661 164.6 101.511 164.45 101.411 164.25C100.011 162.25 99.3113 160.05 99.3113 157.65C99.3113 155.75 99.7113 154 100.511 152.4C100.911 151.4 101.511 150.55 102.311 149.85C103.311 148.85 104.161 148.2 104.861 147.9C107.661 146.6 110.311 146.55 112.811 147.75C115.311 149.05 116.211 151.35 115.511 154.65C115.411 155.05 115.311 155.45 115.211 155.85C114.511 158.15 113.261 159.85 111.461 160.95C110.861 161.35 111.211 161.55 112.511 161.55C113.311 161.55 113.911 161.4 114.311 161.1C115.611 160.1 116.611 157.5 117.311 153.3C118.311 147 119.811 139.9 121.811 132L124.811 118.5C129.511 93.4 131.861 81.2 131.861 81.9C131.861 81.8 129.561 81.75 124.961 81.75C120.061 81.75 117.411 81.4 117.011 80.7C116.811 80.4 116.961 79.25 117.461 77.25C117.961 75.25 118.361 74.1 118.661 73.8L119.111 73.35H126.311H133.511V73.05L135.011 65.7C137.011 55.3 138.961 48.05 140.861 43.95C143.961 37.65 148.611 33.8 154.811 32.4Z" fill="white"></path>
</g>
<defs>
<clipPath id="clip0_1_2">
<rect width="200" height="200" fill="white"></rect>
</clipPath>
</defs>
</svg>

          </div>
        </a>
        <ul>
          
          <li>
            <a href="/blog/">Blog</a>
          </li>
          
          <li>
            <a href="/projects/">Projects</a>
          </li>
          
          <li>
            <a href="https://github.com/dzfrias">GitHub</a>
          </li>
          
        </ul>
      </nav>
    </header>
    
<div aria-hidden="true" class="progress-bar"><div class="progress-bar-inner"></div></div>

    <main tabindex="-1">
      <div id="main-left">
        
<nav class="toc">
        <ol><li><a href="#things-i-liked">Things I liked</a><ol><li><a href="#good-defaults">Good defaults</a></li><li><a href="#error-handling">Error handling</a></li><li><a href="#computed-properties">Computed properties</a></li></ol></li><li><a href="#things-i-disliked">Things I disliked</a><ol><li><a href="#typed-throws">Typed throws</a></li><li><a href="#tooling">Tooling</a></li><li><a href="#ownership">Ownership</a></li></ol></li><li><a href="#results">Results</a></li><li><a href="#wrap-up">Wrap up</a></li></ol>
      </nav>

      </div>
      <div id="main-content" style="margin-top: 1rem; width: var(--width)">
        <div style="width: min(95%, 65ch)">
          
<h1>Experiments with the Swift Language</h1>
<p>Following the announcement that the
<a href="https://ladybird.org/">Ladybird browser engine</a> is going to adopt
<a href="https://www.swift.org/">Swift</a> as a successor language for the codebase, I
decided that it would be worth getting to know the language a little
better.<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup></p>
<p>So, I wrote a toy <a href="https://webassembly.org">WebAssembly</a> parser and validator. I
chose to write a Wasm parser for a few reasons:</p>
<ol>
<li>I've written a few of them before</li>
<li>It's possible that we could integrate my work with the actual browser</li>
<li>It's somewhat low-level and performance matters</li>
</ol>
<p>In this post, I'm going to go over the things I <strong>like and dislike</strong> about
Swift, in comparison to C++ and Rust.<sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup> At the end, I'll do an
evaluation of the choice of Swift as a whole.</p>
<h2 id="things-i-liked" tabindex="-1"><a class="header-anchor" href="#things-i-liked">Things I liked</a></h2>
<p>I'll start off with my favorite things about the language.</p>
<h3 id="good-defaults" tabindex="-1"><a class="header-anchor" href="#good-defaults">Good defaults</a></h3>
<p>I'd say that Swift's <strong>biggest strength</strong> is that it has very good default
semantics.</p>
<p>Compared to a language like Rust, where you have to be <em>more conscious</em> about
the decisions you make, you can generally just “<em>do what you feel like</em>” in
Swift, and it'll be performant and ergonomic.</p>
<p>For example, the
<a href="https://developer.apple.com/documentation/swift/array"><code>Array</code></a> type is always
<a href="https://en.wikipedia.org/wiki/Copy-on-write">copy-on-write</a>. Let's take this
simple program:</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">process</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> a<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// do some work</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> a<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token function">process</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></code></pre>
<p>In this example, <code>a</code> is not copied, even when it's passed into <code>process</code>. It's
also not borrowed, as we might do in Rust. <strong><code>a</code> will never be copied until it
is written to</strong>. This means that we get to treat <code>a</code> as if we own it. There's
<em>no need</em> for lifetimes, but we can also skip the (potential) performance hit
that comes with cloning.</p>
<p>Compared to C++, where <em>everything</em> is implicitly copied unless you pass by
reference, this gives us the semantics we want without having to be explicit
about it.</p>
<p>Compared to Rust, where pretty much nothing is copied <em>ever</em> unless it's
explicit, we don't have to worry about lifetimes at all.</p>
<h3 id="error-handling" tabindex="-1"><a class="header-anchor" href="#error-handling">Error handling</a></h3>
<p>In light of my thoughts on Swift's powerful default semantics, another thing I
really liked was the <strong>error handling</strong> in Swift. It's <em>way</em> better than C++'s
pretty much non-existent error handling, but that's a low bar to clear honestly.</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">enum</span> <span class="token class-name">MyError</span><span class="token punctuation">:</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> ten
  <span class="token keyword">case</span> twenty
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function-definition function">fallible</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> a<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">{</span>
  <span class="token keyword">guard</span> a <span class="token operator">!=</span> <span class="token number">10</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token class-name">MyError</span><span class="token punctuation">.</span>ten
  <span class="token punctuation">}</span>
  <span class="token keyword">guard</span> a <span class="token operator">!=</span> <span class="token number">20</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token class-name">MyError</span><span class="token punctuation">.</span>twenty
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> a
<span class="token punctuation">}</span></code></pre>
<p>When you call a fallible function in Swift (which is marked by the <code>throws</code>
keyword), you have two options:</p>
<ol>
<li>Propagate the error with <code>try</code></li>
<li>Handle the error with <code>do-catch</code></li>
</ol>
<pre class="language-swift"><code class="language-swift"><span class="token comment">// 1. Propagate, if in another function that can throw</span>
<span class="token keyword">try</span> <span class="token function">fallible</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token comment">// 2. Handle the error</span>
<span class="token keyword">do</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token function">fallible</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
  <span class="token comment">// `error` is implicitly put in scope</span>
  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"failed: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">error</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>Error handling in Swift is nice because you don't have to think about it <em>that
much</em>, but you're still forced to handle things.</p>
<p>In Rust, which has the <a href="https://doc.rust-lang.org/std/result/"><code>Result</code></a> type,
you have to think about your errors a lot more when designing your API. You need
to make important decisions like:</p>
<ul>
<li>Do I want my error to be opaque?</li>
<li>How do I carry borrowed data in my <code>Result</code>?</li>
<li>How do I give it idiomatic semantics?</li>
</ul>
<p>Often, in Rust, we use libraries like
<a href="https://docs.rs/anyhow/latest/anyhow/">anyhow</a> and
<a href="https://docs.rs/thiserror/latest/thiserror/">thiserror</a> to answer these
questions. Since Swift has good defaults out of the box, these decisions are
<strong>less pervasive</strong> in our minds.</p>
<h3 id="computed-properties" tabindex="-1"><a class="header-anchor" href="#computed-properties">Computed properties</a></h3>
<p>This is something that I've <strong>changed my mind on</strong> over my time programming, and
largely because of my experiences with Swift. I used to dislike the idea of
computed properties.<sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup> Take this example:</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">Example</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span>
  <span class="token keyword">let</span> id<span class="token punctuation">:</span> <span class="token class-name">UInt</span>

  <span class="token keyword">var</span> fullId<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"#</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">id</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">name</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> e <span class="token operator">=</span> <span class="token class-name">Example</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Diego Frias"</span></span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>fullId<span class="token punctuation">)</span>
<span class="token comment">// alternative w/o computed properties:</span>
<span class="token comment">// print(e.fullId())</span></code></pre>
<p>I don't know if it's just me. Something's kind of nice about them. I'll take a
real snippet from the Wasm parser:</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">ValueType</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> i32
  <span class="token keyword">case</span> i64
  <span class="token keyword">case</span> f32
  <span class="token keyword">case</span> f64
  <span class="token keyword">case</span> funcref
  <span class="token keyword">case</span> externref
  <span class="token keyword">case</span> v128

  <span class="token keyword">public</span> <span class="token keyword">var</span> bitWidth<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token operator">?</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token keyword">self</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span>i32<span class="token punctuation">,</span> <span class="token punctuation">.</span>f32<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token number">32</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span>i64<span class="token punctuation">,</span> <span class="token punctuation">.</span>f64<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token number">64</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span>v128<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token number">128</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span>funcref<span class="token punctuation">,</span> <span class="token punctuation">.</span>externref<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token nil constant">nil</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">var</span> isReference<span class="token punctuation">:</span> <span class="token class-name">Bool</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">self</span> <span class="token operator">==</span> <span class="token punctuation">.</span>funcref <span class="token operator">||</span> <span class="token keyword">self</span> <span class="token operator">==</span> <span class="token punctuation">.</span>externref
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">var</span> isNumeric<span class="token punctuation">:</span> <span class="token class-name">Bool</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">!</span>isReference <span class="token operator">&amp;&amp;</span> <span class="token keyword">self</span> <span class="token operator">!=</span> <span class="token punctuation">.</span>v128
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>They just make sense sometimes. I don't have a lot else to say, I just like
them.</p>
<h2 id="things-i-disliked" tabindex="-1"><a class="header-anchor" href="#things-i-disliked">Things I disliked</a></h2>
<p>While there's <em>a lot</em> to like about Swift, there were definitely some pain
points along the way.</p>
<h3 id="typed-throws" tabindex="-1"><a class="header-anchor" href="#typed-throws">Typed throws</a></h3>
<p>I'll start with something pretty light: the lack of typed throws. When you
declare a fallible function in Swift, you <strong>can't specify</strong> the specific error
type that the function may throw.</p>
<p>Let me illustrate what I mean with an example:</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">enum</span> <span class="token class-name">MyError</span><span class="token punctuation">:</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> invalidInput
  <span class="token keyword">case</span> outOfMemory
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function-definition function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre>
<p>Even if <code>doSomething</code> can <em>only</em> throw <code>MyError</code>, there's no way to put that
info in the signature of the function. This was a little painful when designing
APIs. Sometimes it's useful to <strong>explicitly state</strong> when a function can only
throw a specific error.</p>
<p>There's good news, though! Swift is getting typed throws in version 6! Swift 6.0
isn't out at the time of me writing this, but I'm eagerly awaiting the feature.</p>
<h3 id="tooling" tabindex="-1"><a class="header-anchor" href="#tooling">Tooling</a></h3>
<p>I like writing code in <a href="https://neovim.io/">Neovim</a>.<sup class="footnote-ref"><a href="#fn4" id="fnref4">4</a></sup> When I'm starting out
with a new programming language, there are two things I like to check off:</p>
<ol>
<li><a href="https://tree-sitter.github.io/tree-sitter/">Tree-sitter</a> support</li>
<li><a href="https://en.wikipedia.org/wiki/Language_Server_Protocol">LSP</a> support</li>
</ol>
<p>Swift's tree-sitter grammar is great! However, it's lacking quite a bit in the
LSP department.</p>
<p>There's a general sluggishness when using it, even on small codebases. Many of
handlers for the protocol haven't been implemented, too (like show-references
and rename). The client sometimes quits unexpectedly, and error diagnostics will
linger indefinitely after something has been fixed.</p>
<p>I eventually ended up using the <a href="https://en.wikipedia.org/wiki/Xcode">Xcode</a> IDE
Swift for development. Xcode is nice, but certainly not something I prefer over
Neovim. The Swift team has been investing more and more into the open-source
ecosystem, so hopefully these will be fixed with time.</p>
<h3 id="ownership" tabindex="-1"><a class="header-anchor" href="#ownership">Ownership</a></h3>
<p>Swift has something of an ownership model, a la Rust. But it's not nearly as
comprehensive, for better and for worse.</p>
<p>Firstly, <strong>the concept of borrowing only exists for structs</strong>. This makes sense,
since classes are
<a href="https://en.wikipedia.org/wiki/Reference_counting">reference counted</a>, but just
know that any borrowing/ownership problems are immediately absolved by the
<code>class</code> keyword.</p>
<p>Second, <strong>borrowing is only available in function signature</strong>. There's no such
thing as storing a borrowed value in a struct field (lifetimes would have to be
introduced, which is understandably not in the cards).</p>
<p>The following is allowed:</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">doSomething</span><span class="token punctuation">(</span>with x<span class="token punctuation">:</span> borrowing <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> x<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token number">10</span>
<span class="token function">doSomething</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> x<span class="token punctuation">)</span></code></pre>
<p>But there's no concept of:</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">MyStruct</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> x<span class="token punctuation">:</span> borrowing <span class="token class-name">Int</span>
<span class="token punctuation">}</span></code></pre>
<p>The borrowing/ownership system isn't <em>incomplete</em>, but it's certainly <em>less
powerful</em> than Rust's. I'm not totally familiar with the system yet, so it'll
take some getting used to.</p>
<p>I'm getting the impression that it should be used only for hot paths and hot
copies.</p>
<h2 id="results" tabindex="-1"><a class="header-anchor" href="#results">Results</a></h2>
<p>I'll share a little bit about the Wasm parser/validator itself. It's <em>not</em> fully
spec-compliant, but the core behavior is all correct, so these results wouldn't
change much had I spent the time to make sure it was completely aligned with the
spec.</p>
<p>Running it on <a href="https://spidermonkey.dev/">spidermonkey</a>, we can parse and
validate the module in just 60ms, which is about 2x faster than the C++ version!
That was without any low-level performance optimizations.</p>
<p>Swift's good defaults are both ergonomic and performant, which lends itself to a
quick way to develop reliable software. You can read the
<a href="https://github.com/dzfrias/LibWasm">source code on GitHub</a>.</p>
<h2 id="wrap-up" tabindex="-1"><a class="header-anchor" href="#wrap-up">Wrap up</a></h2>
<p>I really enjoyed this little experiment with Swift! I think Swift is honestly
the <strong>best successor language</strong> choice for Ladybird. It hits the perfect blend
between ease-of-writing and performance, which is exactly what Ladybird needs.</p>
<p>It didn't take very long to write the Wasm parser, and it's already faster than
the C++ version. Of course, I had my fair share of struggles with the language
(and tooling) but I experience was generally extremely pleasant.</p>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>There were numerous reasons Swift was chosen. See
<a href="https://x.com/awesomekling/status/1822236888188498031">Andreas Kling's tweet</a>
for more. My thoughts on it are at the end of this post! <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn2" class="footnote-item"><p>I'm comparing with Rust because it's the language I'm most comfortable with,
and I had some interesting observations about the two languages
side-by-side. <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn3" class="footnote-item"><p>I'd always make the argument of “they're obscuring behavior with syntax!”
Something like that. <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn4" class="footnote-item"><p>by the way. <a href="#fnref4" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>


        </div>
      </div>
      <div id="main-right">
        
        
      </div>
    </main>
  </body>
</html>
